<div class="row">
<div class="col-xs-6">
  <h2><%= l :label_companies %></h2>
</div>

<div class="col-xs-6 text-right">
  <ul class="list-inline fast-menu">
    <li>
      <%= link_to_if_authorized l(:label_company_new), new_project_client_path, class: 'icon-fa icon-fa-fw icon-fa-file' %>
    </li>
    <% if User.current.allowed_to?(:export_clients, @project) -%>
      <li>
        <%= link_to 'CSV', project_clients_path(@project, format: 'csv'), class: 'icon-fa icon-fa-fw' -%>
      </li>
    <% end -%>
  </ul>
</div>
</div>

<!--filtres-->
<%= form_tag({id: @project}, method: :get, class: 'formee') do %>
  <div class="seccio grup">
    <div class="col span-2-de-2">
      <div class="filtres">
        <div class="titularAcc">
          <div class="row">
            <div class="col-xs-6 pad-top-7">
              <span class="icon-fa-right">
                <%= l(:label_filter_plural) %>
              </span>
            </div>
            <div class="col-xs-6 text-right form-inline">
              <div class="form-group">
                <label for="name" class="sr-only"><%= l(:field_has_text) %></label>
                <%= search_field_tag :name, params[:name], class: 'form-control' %>
              </div>
              <%= button_tag(content_tag('i', '', class: 'fa fa-search', 'aria-hidden' => 'true'), :class => "btn btn-search", :name => nil, :type => :submit) %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
<!--final filtres-->

<!--taula-->
<div class="wrapper-table bg-white">
  <table class="table table-striped clients">
    <thead>
      <tr>
        <%= sort_header_tag('taxcode', :caption => l(:field_taxcode)) %>
        <%= sort_header_tag('name', :caption => l(:field_name)) %>
        <th><%=l(:label_issued)%></th>
        <th><%=l(:label_received)%></th>
        <th><%=l(:label_order_plural)%></th>
        <th><%=l(:label_person_plural)%></th>
        <th><%=l(:label_client_offices)%></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% for client in @clients -%>
        <% onclick_show = "onclick=\"javascript: document.location = '#{url_for(:action=>'show', :id=>client)}'\"".html_safe -%>
        <tr class="user <%= cycle("odd senar", "even parell") %>">
          <td class="taxcode" style="cursor:pointer;" <%= onclick_show %>><%=image_tag("link.png") if client.linked?%><%= link_to_if_authorized client.taxcode, :action=>'show', :id=>client %></td>
          <td class="name"><%=h client.name%></td>
          <td class="invoices"><%= client.issued_invoices.any? ? link_to_if_authorized(client.issued_invoices.count, {:controller=>'invoices', :action=>'index', :id=>@project, :client_id=>client}, :title=>l(:label_issued)) : "-" %></td>
          <td class="invoices"><%= client.received_invoices.any? ? link_to_if_authorized(client.received_invoices.count, {:controller=>'received', :action=>'index', :id=>@project, :client_id=>client}, :title=>l(:label_received)) : "-" %></td>
          <td class="orders"><%= client.orders.any? ? link_to_if_authorized(client.orders.count, {:controller=>'orders', :action=>'received', :id=>@project, :client_id=>client}, :title=>l(:label_received)) : "-" %></td>
          <td class="people"><%= link_to_if_authorized client.people.count, client_people_path(client), :title=>l(:label_person_plural) %></td>
          <td class="client_offices"><%= link_to client.client_offices.count, client_client_offices_path(client), :class=>'client_offices-btt', :title=>l(:label_client_offices) %></td>
          <td class="new"><%= link_to_if_authorized l(:button_new_invoice), project_client_new_invoice_path(:project_id=>@project.id,:client=>client.id), :class => 'nova-f-btt', :title=>l(:label_invoice_new) %></td>
        </tr>
      <% end -%>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="8">&nbsp;</td>
      </tr>
    </tfoot>
  </table>
  <!--final taula-->

  <!--paginacio-->
  <div class="wrapper-pagination-results">
    <div class="row">
      <div class="col-xs-4 col-xs-offset-5">
        <!--paginacio-->
        <div class="pagination">
          <%= pagination_links_full @client_pages, @client_count, per_page_links: false %>
        </div>
        <!--final paginacio-->
      </div>
      <div class="col-xs-3 text-right">
        <form class="form-inline">
          <label for="sel-results"><%= l :button_show %></label>
          <%= select_tag('sel-results', options_for_select(Setting.per_page_options_array, selected: params[:per_page]), class: 'form-control') %>
        </form>
      </div>
    </div>
  </div>
  <!--final paginacio-->

</div>

<% if @project.company.companies_with_link_requests.any? -%>
  <h3><%=l(:link_requests)%></h3>
  <ul>
    <% @project.company.companies_with_link_requests.each do |req| -%>
      <li>
        <%=req.taxcode%> <span style="font-weight: bold;"><%=req.name%></span> - 
        <%=link_to_if_authorized l(:allow_link), {:action=>'allow_link',:id=>@project,:req=>req}%> / 
        <%=link_to_if_authorized l(:deny_link), {:action=>'deny_link',:id=>@project,:req=>req} %>
      </li>
    <% end -%>
  </ul>
<% end -%>

<% html_title(l(:label_companies)) -%>

<% content_for :sidebar do %>
  <%= render_menu :companies_menu, @project %>
<% end %>
