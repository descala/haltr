<%
  # client is the new / edited client
  # client.company is the company linked to the client (if any)
  # company is the company we found that matches the entered taxcode
  # we have a client and client is linked and (is already linked to the
  # company we found or we did not found any company)
  if client and client.company #and (client.company == company || company.nil?)
-%>

  <div class="col-xs-12">
    <% if client.allowed? -%>
      <div class="flash info">
        <% if client.company.is_a?(ExternalCompany) and User.current.admin? -%>
          <%= link_to l(:linked_to_profile, :company => client.company.name).html_safe, edit_external_company_path(client.company) %>
          (<%=link_to_if_authorized(l(:unlink),{:controller=>'clients',:action=>'unlink',:id=>client})%>)
        <% else -%>
          <%= l(:linked_to_profile, :company => client.company.name).html_safe %> (<%=link_to_if_authorized(l(:unlink),{:controller=>'clients',:action=>'unlink',:id=>client})%>)
        <% end -%>
      </div>
    <% elsif client.denied? -%>
      <div class="flash error">
        <%= l(:denied_authorization, :company => client.company.name).html_safe %> (<%=link_to_if_authorized(l(:unlink),{:controller=>'clients',:action=>'unlink',:id=>client})%>)
      </div>
    <% else -%>
      <div class="flash info">
        <%= l(:pending_authorization, :company => client.company.name).html_safe %> (<%=link_to_if_authorized(l(:unlink),{:controller=>'clients',:action=>'unlink',:id=>client})%>)
      </div>
    <% end -%>
  </div>

<% elsif company # we found a company to link to -%>
    <div class="col-xs-12">
      <div class="flash info">
        <%= l(:cif_belongs_to_company,{:company=>company.name}).html_safe %>
        <% if company.public? # public profile -%>
          <%= l(:link_to_profile_suggest, :href=>link_to_if_authorized(l(:link_to_profile),{:controller=>'clients',:action=>'link_to_profile',:id=>@project,:company=>company.taxcode,:client=>client})).html_safe %>
          <% else # semipublic profile -%>
            <%= l(:link_to_profile_suggest, :href=>link_to_if_authorized(l(:link_to_profile_ask),{:controller=>'clients',:action=>'link_to_profile',:id=>@project,:company=>company.taxcode,:client=>client})).html_safe %>
          <% end -%>
      </div>
    </div>
<% end -%>
