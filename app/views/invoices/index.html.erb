<div class="row">
<div class="col-xs-6">
  <% if controller.controller_name == 'invoices' -%>
    <h2><%= l :label_issued %></h2>
  <% else -%>
    <h2><%= l :label_received %></h2>
  <% end -%>
</div>
<div class="col-xs-6 text-right">
  <!--menu rapid-->
  <ul class="list-inline fast-menu">
    <li>
      <div class="dropdown">
        <button class="btn btn-default btn-sm dropdown-toggle" type="button" id="dropdownExport" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          <%= l :button_export %>
          <i class="fa fa-angle-down" aria-hidden="true"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownExport">
          <li><%= link_to_if_authorized "#{l(:button_download_new_invoices)}Â (#{num_not_sent})",{:action => 'download_new_invoices'}, :title => l(:label_download_new_invoices_info), :class => 'icon-fa icon-fa-fw icon-fa-file-pdf-o' %></li>
          <li><%= link_to l(:button_download_invoices_csv), project_invoices_path(@project, format: 'csv'), class: 'icon-fa icon-fa-fw icon-fa-file-excel-o' -%></li>
        </ul>
      </div>
    </li>
    <li>
      <div class="dropdown">
        <button class="btn btn-success btn-sm dropdown-toggle" type="button" id="dropdownNew" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          <%= l :button_new %>
          <i class="fa fa-angle-down" aria-hidden="true"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownNew">
          <%=  call_hook(:invoices_index_menu_top) %>
          <% if controller.controller_name == "invoices" %>
            <li><%= link_to(l("label_invoice"), new_project_invoice_path(@project), class: 'icon-fa icon-fa-fw icon-fa-file') %></li>
          <% end %>
          <% if num_new_invoices > 0 %>
            <li><%= link_to "#{l(:button_generate_invoices)} (#{num_new_invoices})", {action: 'new_invoices_from_template', controller: 'invoice_templates'}, method: :post, class: 'icon-fa icon-fa-fw icon-fa-folder-open' %></li>
          <% end -%>

          <li>
            <% if controller.controller_name == "invoices" %>
              <%= link_to l(:label_import), project_invoices_upload_path(@project), class: 'icon-fa icon-fa-fw icon-fa-upload' -%>
            <% else %>
              <%= link_to l(:label_import), project_received_upload_path(@project), class: 'icon-fa icon-fa-fw icon-fa-upload' -%>
            <% end %>
          </li>
          <%=  call_hook(:invoices_index_menu_bottom) %>
        </ul>
      </div>
    </li>
  </ul>
  <!--final menu rapid-->
</div>
</div>

<!--filtres-->
<%= form_tag({:id=>@project}, :method => :get, :class => 'formee') do %>
  <div class="seccio grup">
    <div class="col span-2-de-2">
      <div class="filtres">
        <div class="titularAcc">
          <div class="row">
            <div class="col-xs-6 pad-top-7">
              <a class="titularAccFilters icon-fa-right icon-fa-right-angle-down">
                <%= l(:label_filter_plural) %>
              </a>
            </div>
            <div class="col-xs-6 text-right form-inline">
              <div class="form-group">
                <label for="has_text" class="sr-only"><%= l(:field_has_text) %></label>
                <%= search_field_tag :has_text, params[:has_text], class: 'form-control' %>
              </div>
              <%= button_tag(content_tag('i', '', class: 'fa fa-search', 'aria-hidden' => 'true'), :class => "btn btn-search", :name => nil, :type => :submit) %>
            </div>
          </div>
        </div>
        <div class="contingutAcc">
          <fieldset>
            <div id="query_form_content" class="hide-when-print seccio grup">
              <div class="row">

                <div class="col-xs-6">
                  <div class="row">

                    <div class="col-xs-5 col-no-pad-right">
                      <div class="form-group">
                        <label for="sel_data"><%= l :field_date %>:</label>
                        <%= select_tag 'sel_data',
                          options_for_select([
                            [l(:field_date), 'date'],
                            [l(:tag_due), 'due_date'],
                            [l(:field_state_updated_at), 'state_updated_at'],
                        ], selected: params[:sel_data]),
                        class: 'form-control' -%>
                      </div>
                    </div>

                    <div class="col-xs-7">
                      <div class="row">
                        <div class="col-xs-6 col-no-pad-right">
                          <div class="form-group">
                            <label for="date_from" class="normal"><%= l :label_from %></label>
                            <div class="relative">
                              <%= date_field_tag :date_from, params[:date_from], class: 'form-control' %><%= calendar_for('date_from') %>
                            </div>
                          </div>
                        </div>
                        <div class="col-xs-6 col-no-pad-right">
                          <div class="form-group">
                            <label for="date_to" class="normal"><%= l :label_to %></label>
                            <div class="relative">
                              <%= date_field_tag :date_to, params[:date_to], class: 'form-control' %><%= calendar_for('date_to') %>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div>
                  <div>
                    <label for="client"><%= l :field_client %>:</label>
                    <div class="row">
                      <div class="col-xs-5 col-no-pad-right">
                        <div class="form-group">
                          <%= text_field_tag :client, params[:client], placeholder: "#{l(:field_taxcode)}, #{l(:field_name)}", class: 'form-control' %>
                        </div>
                      </div>
                      <div class="col-xs-7 col-no-pad-right">
                        <div class="form-group">
                        </div>
                      </div>
                    </div>
                  </div>

                </div> <!-- col-xs-6 -->
                <div class="col-xs-6 col-separated-left">

                  <p class="like-label"><strong><%= l :label_invoice_state %></strong></p>
                  <div class="row">
                    <div class="col-xs-4">

                      <div class="checkbox">
                        <label class="inline">
                          <%= check_box_tag("state_all", "1", params["state_all"]) %> <%=l("label_all_invoices")%>
                        </label>
                      </div>

                      <% %w(new sending sent read error cancelled closed discarded registered refused accepted allegedly_paid annotated).to_enum.with_index(1) do |state, i| -%>
                        <%= "</div><div class=\"col-xs-4\">".html_safe if i % 5 == 0 %>
                        <div class="checkbox">
                          <label>
                            <%= check_box_tag(state, "1", params[state]) %> <%=l("state_#{state}_plural")%>
                          </label>
                        </div>
                      <% end -%>

                      </div>
                  </div>

                </div>
              </div>
              <hr>
              <div class="text-right set-of-buttons">
                <button type="reset" value="Reset" class="btn btn-link"><%= l :button_clear %></button>
                <%= submit_tag l(:button_apply), :class => "btn btn-primary", :name => nil %>
              </div>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
  </div>
<% end -%>
<!--final filtres-->


<div class="wrapper-table bg-white">
  <!--taula factures-->
  <%= form_tag({}) do -%>
    <%= hidden_field_tag 'back_url', url_for(params), :id => nil %>
    <div class="seccio grup">
      <div class="col span-2-de-2">
        <table class="table table-striped table-hover invoices">
          <thead>
            <tr>
              <th></th>
              <%= sort_header_tag('number', caption: l(:field_number)) %>
              <%= sort_header_tag('date', caption: l(:field_date)) %>
              <%= sort_header_tag('due_date', caption: l(:field_terms)) %>
              <%= sort_header_tag('clients.name', caption: l(:field_company)) %>
              <%= sort_header_tag('import_in_cents', caption: l(:tag_subtotal), class: 'text-right') %>
              <%= sort_header_tag('total_in_cents', caption: l(:tag_total), class: 'text-right') %>
              <%= sort_header_tag('state', title: l(:label_sort_by, "\"#{l(:field_state)}\""), caption: l(:field_state)) %>
            </tr>
          </thead>
          <tbody>
            <% @invoices.each do |invoice| -%>
              <%if invoice.total > invoice.total_paid and invoice.total_paid.cents != 0%>
                <tr id="invoice-<%=invoice.id%>" class="halfpaid hascontextmenu <%= 'amended ' if invoice.amended? %>">
                <%else%>
                  <tr id="invoice-<%=invoice.id%>" class="hascontextmenu <%= 'amended ' if invoice.amended? %>">
                  <% end %>
                  <td><%= check_box_tag("ids[]", invoice.id, false, :id => nil) %></td>
                  <td><%=h link_to_if_authorized invoice.number.blank? ? "?" : invoice.number, :action => 'show', :id => invoice %></td>
                  <td><%=h format_date invoice.date %></td>
                  <td <%='class="pastdue"'.html_safe if invoice.past_due?%>><%=h format_date invoice.due_date %><%= call_hook(:invoices_index_due_date, { invoice: invoice }) %></td>
                  <td><%=h invoice.client_office ? invoice.client_office : invoice.client %></td>
                  <td class="money"><%= money(invoice.subtotal) %></td>
                  <td class="money"><%= money(invoice.total) %></td>
                  <td><%=h l("state_#{invoice.state}").capitalize %></td>
                  </tr>
                <% end -%>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="8"><%= call_hook(:invoices_index_list_footer, {pages: @invoice_pages}) %></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  <% end -%>
  <!--final taula factures-->

  <!--paginacio-->
  <div class="wrapper-pagination-results">
    <div class="row">
      <div class="col-xs-4 col-xs-offset-5">
        <div class="pagination">
          <%= pagination_links_full(@invoice_pages, @invoice_count, per_page_links: false) %>
        </div>
      </div>
      <div class="col-xs-3 text-right">
        <form class="form-inline">
          <label for="sel-results"><%= l :button_show %></label>
          <%= select_tag('sel-results', options_for_select(Setting.per_page_options_array, selected: params[:per_page]), class: 'form-control') %>
        </form>
      </div>
    </div>
  </div>
  <!--final paginacio-->

</div>

<% html_title(l(:label_invoice_plural)) -%>

<% content_for :sidebar do %>
  <%= render_menu :invoices_menu, @project %>
<% end %>

<%= context_menu "/#{controller.controller_name}/context_menu" %>
