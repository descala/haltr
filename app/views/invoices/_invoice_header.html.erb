<div class="invoice-header">

  <div id="amends">
    <% if @invoice.amend and @invoice.amend != @invoice -%>
      <h3><%=l(:amended_by_invoice, :link => link_to_if_authorized("#{l(:label_amendment_invoice)} #{@invoice.amend.number}",
                                                                   :controller => 'invoices', :action=>'show', :id=>@invoice.amend)).html_safe %></h3>
    <% end -%>
  </div>
  <!-- Vendor Info -->
  <div class="vcard vendor">
    <div class="invoicelogo">
      <% if @company.attachments.any? -%>
        <% if @is_pdf %>
          <% if @debug %>
            <%= tag 'img', :src => "/invoices/logo/#{@company.attachments.first.id}/#{@company.attachments.first.filename}", :alt => "#{@company.name} Logo" -%>
          <% else %>
            <%= tag 'img', :src => @company.attachments.first.diskfile -%>
          <% end -%>
        <% else %>
          <%= tag 'img', :src => "/invoices/logo/#{@company.attachments.first.id}/#{@company.attachments.first.filename}", :alt => "#{@company.name} Logo" -%>
        <% end -%>
      <% end -%>
    </div>
    <div class="vendor-info">
      <% if @invoice.is_a?(Quote) and !@invoice.description.blank? -%>
        <h2><%=@invoice.description%></h2>
      <% end -%>
      <h3><%=h @company.name %></h3>
      <address class="adr">
        <div class="street-address"><%=h @company.address %></div>
        <span class="postal-code"><%=h @company.postalcode %></span> <span class="locality"><%=h @company.city %></span>
        <div class="region"><%=h @company.province %></div>
        <div class="country-name"></div>
      </address>
      <div><strong><%=h l(:field_taxcode) %></strong><span class="tax-id"> <%=h @company.taxcode %></span></div>
      <div style="height:10px;"></div>
      <div><%= @company.website %></div>
      <div><%= @company.email %></div>
      <% if @invoice.party_identification.present? -%>
        <div>
          <%= t(:field_party_identification) %>: <%= @invoice.party_identification %>
        </div>
      <% end -%>
    </div>
  </div>

  <!-- Invoice Number and Info -->
  <h2 class="invoice-ID"><%=h @invoice.label %> <%=h @invoice.number %></h2>
  <% unless @invoice.series_code.blank? -%>
    <h3><%= l(:field_series_code) %>: <%= @invoice.series_code %></h3>
  <% end -%>
  <div class="invoice-info">
    <span class="date"><%=h l(:field_date)%> <strong><%=h format_date @invoice.date %></strong></span><br/>
    <% if @invoice.amend_of -%>
      <% if @invoice.amend_of == @invoice -%>
        <span class="invoice-terms"><%=h l(:label_amended_invoice)%>: ?</span><br/>
      <% else -%>
        <span class="invoice-terms"><%=h l(:label_amended_invoice)%>: <%= link_to_if_authorized @invoice.amend_of.number,{:controller => 'invoices', :action => 'show', :id => @invoice.amend_of} %></span><br/>
      <% end -%>
    <% end -%>
    <% unless @invoice.due_date.blank? -%>
      <% if @invoice.is_a?(Quote) -%>
        <span class="invoice-terms<%=h " pastdue" if @invoice.past_due?%>"><%=h l(:valid_until)%> <%=h format_date @invoice.due_date %></span><br/>
      <% else -%>
        <span class="invoice-terms<%=h " pastdue" if @invoice.past_due?%>"><%=h l(:field_due_date)%> <%=h format_date @invoice.due_date %> <%= "(#{@invoice.terms_description})" unless @invoice.custom_due? %></span><br/>
      <% end -%>
    <% end -%>
    <% if @invoice.invoicing_period_start.present? || @invoice.invoicing_period_end.present? -%>
      <span class="invoice-terms"><%=h "#{t(:field_invoicing_period)} #{format_date @invoice.invoicing_period_start}  #{format_date @invoice.invoicing_period_end}" %></span><br/>
    <% end -%>
    <% unless payment_method_info.blank? -%>
      <span class="invoice-terms"><%=h payment_method_info.html_safe %></span><br/>
    <% end -%>
    <% unless @invoice.ponumber.blank? -%>
      <span class="invoice-terms"><%=h "#{t(:field_ponumber)} #{@invoice.ponumber}" %></span><br/>
    <% end -%>
    <% unless @invoice.delivery_note_number.blank? -%>
      <span class="invoice-terms"><%=h "#{t(:field_delivery_note_number)} #{@invoice.delivery_note_number}" %></span>
    <% end -%>
    <% unless @invoice.receiver_contract_reference.blank? -%>
      <span class="invoice-terms"><%=h "#{t(:field_receiver_contract_reference)} #{@invoice.receiver_contract_reference}" %></span>
    <% end -%>
    <%= call_hook(:invoice_view_invoice_info) %>
  </div>

  <!-- Client Info -->
  <% unless @client.new_record? -%>
    <div class="vcard client">
      <div class="client-info">
        <h3><%= client_name_with_link @client %></h3>
        <address class="adr">
          <div class="street-address"><%=h @client.address %></div>
          <div class="street-address"><%=h @client.address2 %></div>
          <span class="postal-code"><%=h @client.postalcode %></span>
          <% if !@client.city.blank? or !@client.province.blank? -%>
            <span class="locality"><%=h @client.city.strip unless @client.city.blank? %></span>
            <% unless @client.province.blank? -%>, <span class="region"><%=h @client.province %></span><% end -%>
          <% end -%>
          <div class="country-name"><%=h @client.country_name if @client.country and @client.country.downcase != @company.country.downcase %></div>
        </address>
        <div><strong><%=h l(:field_taxcode) %>:</strong><span class="tax-id"> <%=h @client.taxcode.upcase if @client.taxcode %></span></div>
        <% if call_hook(:invoice_view_client_info).present? -%>
          <%= call_hook(:invoice_view_client_info) %>
        <% elsif @invoice.has_dir3_info? -%>
          <% if @invoice.oficina_comptable.present? -%>
            <div>
              <%=h l(:oficina_comptable) %>: <%= @invoice.oficina_comptable %>
            </div>
          <% end -%>
          <% if @invoice.organ_gestor.present? -%>
            <div>
              <%=h l(:organ_gestor) %>: <%= @invoice.organ_gestor %>
            </div>
          <% end -%>
          <% if @invoice.unitat_tramitadora.present? -%>
            <div>
              <%=h l(:unitat_tramitadora) %>: <%= @invoice.unitat_tramitadora %>
            </div>
          <% end -%>
          <% if @invoice.organ_proponent.present? -%>
            <div>
              <%= h l(:field_organ_proponent) %>: <%= @invoice.organ_proponent %>
            </div>
          <% end -%>
          <% if @invoice.unidad_contratacion.present? -%>
            <div>
              <%= h l(:field_unidad_contratacion) %>: <%= @invoice.unidad_contratacion%>
            </div>
          <% end -%>
        <% end -%>
        <% if @invoice.file_reference.present? -%>
          <div>
            <%= h l(:field_file_reference) %>: <%= @invoice.file_reference %>
          </div>
        <% end -%>
      </div>
    </div>
  <% end -%>

</div>
