<%= error_messages_for 'invoice' %>

<h2><%=l(:label_quote)%></h2>

<div class="form-horizontal tab-pane">
  <div class="row">

    <div class="form-group">
      <%= f.label :title, class: 'col-xs-3 control-label' do %>
        <%= l :field_title %>
      <% end -%>
      <div class="col-xs-4">
        <%= f.text_field :title, class: 'form-control' %>
      </div>
    </div>

    <div class="form-group">
      <%= f.label :description, class: 'col-xs-3 control-label' do %>
        <%= l :field_description %>
      <% end -%>
      <div class="col-xs-4">
        <%= f.text_area :description, rows: 1, class: 'form-control' %>
      </div>
    </div>

    <div class="form-group">
      <%= f.label :company, class: 'col-xs-3 control-label' do %>
        <%= l :field_company %>
      <% end -%>
      <div class="col-xs-4">
        <%= f.select :company, clients_for_select, {}, class: 'form-control' %>
      </div>
    </div>

    <div class="form-group">
      <%= f.label :date, class: 'col-xs-3 control-label' do %>
        <%= l :field_date %>
      <% end -%>
      <div class="col-xs-3">
        <div class="relative">
          <%= f.date_field :date, required: true, class: 'form-control' %>
          <%= calendar_for('quote_date') %>
        </div>
      </div>
    </div>

    <div class="form-group">
      <%= f.label :due_date, class: 'col-xs-3 control-label' do %>
        <%= l :valid_until %>
      <% end -%>
      <div class="col-xs-3">
        <input type="hidden" value="custom" id="invoice_terms" />
        <div class="relative">
          <%= f.date_field :due_date, class: 'form-control' %>
          <%= calendar_for('quote_due_date') %>
        </div>
      </div>
    </div>

    <div class="form-group">
      <%= f.label :number, class: 'col-xs-3 control-label' do %>
        <%= l :field_number %>
      <% end -%>
      <div class="col-xs-3">
        <%= f.text_field :number, required: true, class: 'form-control' %>
        <span class="text"><%= "#{l(:label_last_invoice_number)}: #{Quote.last_number(@project)}" if @project.quotes.any?%></span>
      </div>
    </div>

    <div class="form-group">
      <%= f.label :discount_text, class: 'col-xs-3 control-label' do %>
        <%= l :field_discount_text %>
      <% end -%>
      <div class="col-xs-4">
        <%= f.text_field :discount_text, class: 'form-control' %>
      </div>
    </div>

    <div class="form-group">
      <%= f.label :discount, class: 'col-xs-3 control-label' do %>
        <%= l :field_discount %>
      <% end -%>
      <div class="col-xs-2">
        <%= f.text_field :discount, class: 'form-control' %>
      </div>
      <div class="col-xs-2">
        <%= f.select 'discount_type', ['%','â‚¬'], {}, class: 'form-control' %>
      </div>
    </div>

    <div class="form-group">
      <%= f.label :accounting_cost, class: 'col-xs-3 control-label' do %>
        <%= l :field_accounting_cost %>
      <% end -%>
      <div class="col-xs-4">
        <%= f.text_field :accounting_cost, class: 'form-control' %>
      </div>
    </div>


    <div class="form-group">
      <%= f.label :extra_info, class: 'col-xs-3 control-label' do %>
        <%= l :field_extra_info %>
      <% end -%>
      <div class="col-xs-4">
        <%= f.text_area :extra_info, rows: 3, class: 'form-control' %>
      </div>
    </div>

  </div>

  <hr class="form-elements">

  <label><%=l(:label_tax_plural)%></label>

  <% if @invoice.taxes_hash.empty? -%>
    <%= link_to_if_authorized l(:add_taxes_on_company), project_my_company_path(@project) -%>
  <% end -%>

  <% @invoice.taxes_hash.keys.sort.each do |name| -%>
    <div class="form-group">
      <div class="col-xs-3">
        <%= label_tag "#{name}_global", name%>
        <%= select_tag("#{name}_global",
                       options_for_select(tax_categories_array(@invoice,name),
                                          selected: @invoice.global_code_for(name)),
        disabled: @invoice.tax_per_line?(name),
        style: "width: 90px;",
        'class' => 'global_tax',
        'data-tax-name' => name ) %>
      </div>
      <div class="col-xs-3 check-box-alineat">
        <%= check_box_tag("#{name}_multiple", 1, @invoice.tax_per_line?(name), class: 'global_tax_check', 'data-tax-name' => name) %>
        <span>
          <%= l(:line_specific_tax) %>
        </span>
      </div>
      <div id="<%=name%>_comment" style="<%= hide_if_not_exempt_tax(name) %>" class="col span-3-de-5">
        <%= label_tag "#{name}_comment", l("field_comment") %>
        <%= text_field_tag("#{name}_comment", @invoice.global_comment_for(name)) %>
      </div>
    </div>
  <% end -%>


  <label><%=l(:field_invoice_lines)%></label>
  <div id="invoice_lines" data-tax-names="<%= @project.company.tax_names.join(' ') %>">
    <%= f.fields_for :invoice_lines do |line_form| %>
      <%=  render partial: 'invoice_line_fields', locals: { f: line_form } %>
    <% end %>
  </div>
  <div class="form-group">
    <div class="col-xs-3">
      <!-- cocoon -->
      <span class='mes'><%= link_to_add_association l(:button_add_invoice_line), f, :invoice_lines, 'data-association-insertion-node' => '#invoice_lines', 'data-association-insertion-method' => 'append' %></span>
    </div>
  </div>
